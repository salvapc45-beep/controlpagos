<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA SDJ - CONTROL TOTAL</title>
    <style>
        :root {
            --primary: #1e3a8a; --success: #2ecc71; --danger: #e74c3c;
            --warning: #f39c12; --bg: #f4f7fa; --text: #1e293b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; }

        /* HEADER Y NAVEGACIÃ“N */
        header { background: var(--primary); color: white; padding: 15px; text-align: center; font-size: 1.2rem; font-weight: bold; }
        
        nav {
            display: flex; background: #ffffff; border-bottom: 2px solid #e2e8f0;
            position: sticky; top: 0; z-index: 1000; overflow-x: auto;
        }
        .nav-link {
            flex: 1; text-align: center; padding: 15px 5px; cursor: pointer;
            font-weight: 700; color: #64748b; font-size: 13px; transition: 0.3s;
            border-bottom: 4px solid transparent; min-width: 100px;
        }
        .nav-link.active { color: var(--primary); border-bottom-color: var(--primary); background: #f8fafc; }

        /* CONTENEDOR DE SECCIONES */
        .main-content { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* TARJETAS Y FORMULARIOS */
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .form-section { display: flex; flex-direction: column; gap: 15px; }
        .input-box { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: var(--primary); text-transform: uppercase; }
        input, select { padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px; outline: none; }
        input:focus { border-color: var(--primary); }

        .btn-save { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* TABLAS PROFESIONALES */
        .table-container { overflow-x: auto; background: white; border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f1f5f9; padding: 12px; text-align: left; font-size: 11px; color: #475569; }
        td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }

        /* ETIQUETAS */
        .tag { padding: 4px 8px; border-radius: 5px; font-size: 10px; font-weight: bold; color: white; }
        .tag-pre { background: #db2777; } .tag-pri { background: #2563eb; } .tag-bac { background: #7c3aed; }

        /* BOTONES DE ACCIÃ“N */
        .actions { display: flex; gap: 8px; }
        .btn-notif { background: var(--warning); color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn-del { background: var(--danger); color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; }

        #toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 15px; border-radius: 8px; display: none; z-index: 2000; }
    </style>
</head>
<body>

<header>CONTROL ADMINISTRATIVO SDJ</header>

<nav>
    <div class="nav-link active" onclick="switchTab('registro')">1. REGISTRO</div>
    <div class="nav-link" onclick="switchTab('deudores')">2. DEUDORES</div>
    <div class="nav-link" onclick="switchTab('verificar')">3. VERIFICAR PAGOS</div>
</nav>

<div class="main-content">
    
    <section id="registro" class="tab-content active">
        <div class="card">
            <h3 style="margin-bottom:20px; color:var(--primary)">Registrar Nuevo Estudiante</h3>
            <div class="form-section">
                <div class="input-box">
                    <label>Nombre y Apellido del Estudiante</label>
                    <input type="text" id="nomE" placeholder="Nombre completo">
                </div>
                <div class="input-box">
                    <label>Representante y Correo</label>
                    <input type="text" id="nomR" placeholder="Nombre del Representante" style="margin-bottom:8px">
                    <input type="email" id="mailR" placeholder="correo@ejemplo.com">
                </div>
                <div class="input-box">
                    <label>Grado / AÃ±o AcadÃ©mico</label>
                    <select id="gra">
                        <option value="">-- Seleccionar --</option>
                        <optgroup label="PREESCOLAR">
                            <option value="Maternal">Maternal</option>
                            <option value="Preescolar 1">Preescolar 1</option>
                            <option value="Preescolar 2">Preescolar 2</option>
                            <option value="Preescolar 3">Preescolar 3</option>
                        </optgroup>
                        <optgroup label="PRIMARIA">
                            <option value="1er Grado">1er Grado</option>
                            <option value="2do Grado">2do Grado</option>
                            <option value="3er Grado">3er Grado</option>
                            <option value="4to Grado">4to Grado</option>
                            <option value="5to Grado">5to Grado</option>
                            <option value="6to Grado">6to Grado</option>
                        </optgroup>
                        <optgroup label="BACHILLERATO">
                            <option value="1er AÃ±o">1er AÃ±o</option>
                            <option value="2do AÃ±o">2do AÃ±o</option>
                            <option value="3er AÃ±o">3er AÃ±o</option>
                            <option value="4to AÃ±o">4to AÃ±o</option>
                            <option value="5to AÃ±o">5to AÃ±o</option>
                        </optgroup>
                    </select>
                </div>
                <div class="input-box">
                    <label>Mes de la Deuda</label>
                    <select id="mes">
                        <option value="InscripciÃ³n">InscripciÃ³n</option>
                        <option value="Septiembre">Septiembre</option>
                        <option value="Octubre">Octubre</option>
                        <option value="Noviembre">Noviembre</option>
                        <option value="Diciembre">Diciembre</option>
                        <option value="Enero">Enero</option>
                        <option value="Febrero">Febrero</option>
                        <option value="Marzo">Marzo</option>
                        <option value="Abril">Abril</option>
                        <option value="Mayo">Mayo</option>
                        <option value="Junio">Junio</option>
                        <option value="Julio">Julio</option>
                    </select>
                </div>
                <div class="input-box">
                    <label>Monto Adeudado ($)</label>
                    <input type="number" id="mon" placeholder="0.00">
                </div>
                <button class="btn-save" id="btnSave">GUARDAR ESTUDIANTE</button>
            </div>
        </div>
    </section>

    <section id="deudores" class="tab-content">
        <div class="card">
            <h3 style="margin-bottom:15px">Lista General de Deudores</h3>
            <input type="text" id="busD" placeholder="ðŸ” Buscar por nombre o grado..." style="width:100%; margin-bottom:20px; padding:10px; border-radius:8px; border:1px solid #ddd">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Grado</th>
                            <th>Mes</th>
                            <th>Saldo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="listaDeudores"></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="verificar" class="tab-content">
        <div class="card">
            <h3 style="margin-bottom:15px">Reportes de Padres (Por Validar)</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Referencia</th>
                            <th>Monto</th>
                            <th>Validar</th>
                        </tr>
                    </thead>
                    <tbody id="listaPagos"></tbody>
                </table>
            </div>
        </div>
    </section>

</div>

<div id="toast"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC_m1k2Vlu5QTokgjNZ6czlI2XH1YTC3U8",
        authDomain: "reportedepagos-d8485.firebaseapp.com",
        projectId: "reportedepagos-d8485",
        storageBucket: "reportedepagos-d8485.appspot.com",
        messagingSenderId: "335664812002",
        appId: "1:335664812002:web:609ecb3008145281af3bb8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // FUNCIÃ“N PARA CAMBIAR ENTRE APARTADOS
    window.switchTab = (id) => {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    };

    function notify(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg; t.style.display = "block";
        setTimeout(() => t.style.display = "none", 3000);
    }

    // REGISTRAR
    document.getElementById("btnSave").addEventListener("click", async () => {
        const nom = document.getElementById("nomE").value;
        const gra = document.getElementById("gra").value;
        const mon = document.getElementById("mon").value;
        
        if(!nom || !gra || !mon) return alert("Por favor complete Nombre, Grado y Monto");

        await addDoc(collection(db, "deudas"), {
            nombreEst: nom,
            nombreRep: document.getElementById("nomR").value,
            correoRep: document.getElementById("mailR").value,
            gradoEst: gra,
            mesDeuda: document.getElementById("mes").value,
            montoDeuda: mon,
            fechaReg: new Date().toLocaleDateString()
        });
        notify("âœ… Estudiante registrado con Ã©xito");
        document.querySelectorAll("input").forEach(i => i.value = "");
    });

    // ESCUCHAR DEUDORES
    onSnapshot(collection(db, "deudas"), (snap) => {
        const list = document.getElementById("listaDeudores");
        list.innerHTML = "";
        snap.forEach(d => {
            const i = d.data();
            let tag = i.gradoEst.includes("AÃ±o") ? "tag-bac" : (i.gradoEst.includes("Grado") ? "tag-pri" : "tag-pre");
            list.innerHTML += `
                <tr>
                    <td><b>${i.nombreEst}</b><br><small>${i.nombreRep}</small></td>
                    <td><span class="tag ${tag}">${i.gradoEst}</span></td>
                    <td>${i.mesDeuda}</td>
                    <td style="color:red; font-weight:bold">$${i.montoDeuda}</td>
                    <td class="actions">
                        <button class="btn-notif" onclick="window.sendNotif('${i.correoRep}', '${i.nombreEst}', '${i.mesDeuda}', '${i.montoDeuda}')">Notificar</button>
                        <button class="btn-del" onclick="window.delD('${d.id}')">X</button>
                    </td>
                </tr>`;
        });
    });

    // ESCUCHAR PAGOS
    onSnapshot(collection(db, "pagos_reportados"), (snap) => {
        const list = document.getElementById("listaPagos");
        list.innerHTML = "";
        snap.forEach(d => {
            const i = d.data();
            list.innerHTML += `
                <tr>
                    <td>${i.nombreEst}</td>
                    <td><small>${i.referencia}</small></td>
                    <td><b>$${i.monto}</b></td>
                    <td><button onclick="window.delP('${d.id}')" style="background:green; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer">OK</button></td>
                </tr>`;
        });
    });

    window.sendNotif = (mail, est, mes, monto) => {
        if(!mail) return alert("Sin correo registrado");
        const body = `Hola, le recordamos el pago pendiente de ${est} del mes de ${mes} por $${monto}.`;
        window.location.href = `mailto:${mail}?subject=Cobro SDJ&body=${encodeURIComponent(body)}`;
    }

    window.delD = async (id) => { if(confirm("Â¿Eliminar registro?")) await deleteDoc(doc(db, "deudas", id)); };
    window.delP = async (id) => { if(confirm("Â¿Validar este pago?")) await deleteDoc(doc(db, "pagos_reportados", id)); };

    // BUSCADOR
    document.getElementById("busD").addEventListener("input", (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll("#listaDeudores tr").forEach(tr => {
            tr.style.display = tr.textContent.toLowerCase().includes(val) ? "" : "none";
        });
    });
</script>
</body>
</html>
